@using ApexCharts
@using FramerateAnalizer

<MudContainer Class="d-flex justify-center align-center mt-10" Style="width: 100%">
    <ApexChart TItem="FramerateCapture"
               Title="Framerate Aggregated Values"
               Options=options
               Height="500">
        
        <ApexPointSeries TItem="FramerateCapture"
                         Items="Captures"
                         Name="FPS Avg"
                         SeriesType="SeriesType.Bar"
                         YAggregate="@(e => e.Sum(x => (decimal)x.AggregatesRunStats.Average))"
                         XValue="@(e => e.Cpu)" />

        <ApexPointSeries TItem="FramerateCapture"
                         Items="Captures"
                         Name="FPS 10%"
                         SeriesType="SeriesType.Bar"
                         YAggregate="@(e => e.Sum(x => (decimal)x.AggregatesRunStats.TenPercentLowAverage))"
                         XValue="@(e => e.Cpu)" />

        <ApexPointSeries TItem="FramerateCapture"
                         Items="Captures"
                         Name="FPS 1%"
                         SeriesType="SeriesType.Bar"
                         YAggregate="@(e => e.Sum(x => (decimal)x.AggregatesRunStats.OnePercentLowAverage))"
                         XValue="@(e => e.Cpu)" />

        <ApexPointSeries TItem="FramerateCapture"
                         Items="Captures"
                         Name="FPS 0.1%"
                         SeriesType="SeriesType.Bar"
                         YAggregate="@(e => e.Sum(x => (decimal)x.AggregatesRunStats.ZeroPointOnePercentLowAverage))"
                         XValue="@(e => e.Cpu)" />
    </ApexChart>
</MudContainer>

@code {
    [Parameter] public List<FramerateCapture> Captures { get; set; }

    private ApexChartOptions<FramerateCapture> options;

    protected override void OnInitialized()
    {
        options = new ApexChartOptions<FramerateCapture>
        {
            Chart = new Chart
            {
                Stacked = true,
                StackType = StackType.Normal,
                Toolbar = new Toolbar
                {
                    Show = false
                },
                Width = "1400px",
            },
            PlotOptions = new PlotOptions
            {
                Bar = new PlotOptionsBar
                {
                    Horizontal = true,
                    BarHeight = "15%"
                }
            },
            Theme = new Theme { Mode = Mode.Light, Palette = PaletteType.Palette8 },

            Xaxis = new XAxis
            {
                Title = new AxisTitle
                {
                    Text = "FPS",
                    Style = new AxisTitleStyle
                    {
                        FontSize = "14px"
                    }
                },
                Labels = new XAxisLabels
                {
                    Style = new AxisLabelStyle
                    {
                        FontSize = "14px"
                    }
                }
            },
            Yaxis = new List<YAxis> { 
                new YAxis
                {
                    Title = new AxisTitle
                    {
                        Text = "CPU",
                        Style = new AxisTitleStyle {
                            FontSize = "14px"
                        }
                    },
                    Labels = new YAxisLabels {
                        MaxWidth = 260,
                        Style = new AxisLabelStyle {
                            FontSize = "14px"
                        } 
                    }
                }
            },
            Legend = new Legend
            {
                Position = LegendPosition.Right
            },
            DataLabels = new DataLabels
            {
                Formatter = "function (val) { return val.toFixed(1); }"
            },
            Colors = new List<string> { "#1f77b4", "#2ca02c", "#ff7f0e", "#ff4d00" }
        };

        Captures = Captures
            .GroupBy(c => c.Cpu)
            .SelectMany(c => c)
            .ToList();

        base.OnInitialized();
    }
}
